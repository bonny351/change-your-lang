<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Spa Music Kiosk</title>

<style>
/* ================= BASE ================= */
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#030b10;
  font-family:Arial, sans-serif;
  color:white;
  overflow:hidden;
}
.hidden{display:none}

/* ================= BACKGROUND ================= */
body::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at center, rgba(0,255,200,.12), transparent 60%),
    linear-gradient(#02080c,#03141c);
  z-index:-2;
}

/* ================= RIPPLE ================= */
canvas#ripple{
  position:absolute;
  inset:0;
  z-index:-1;
}

/* ================= HOME ================= */
#home{
  position:absolute;
  inset:0;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:60px;
  padding:80px;
  justify-items:center;
  align-items:center;
}
.profile{
  width:180px;
  height:180px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  background:radial-gradient(circle,#1effb0,#0a4f3a);
  box-shadow:0 0 40px rgba(0,255,200,.6);
}
.profile:active{transform:scale(.95)}

/* ================= PLAYER ================= */
#player{
  position:absolute;
  inset:0;
  padding:40px;
}
h1{margin:0 0 15px 0}

.song{
  padding:18px;
  border-bottom:1px solid rgba(255,255,255,.1);
  font-size:20px;
}
.song:active{
  background:#1db954;
  color:black;
}

/* ================= CONTROLS ================= */
button{
  padding:14px 26px;
  border:none;
  border-radius:12px;
  background:#1db954;
  font-size:18px;
  margin-top:20px;
}
button:active{transform:scale(.95)}

#controls{
  position:fixed;
  bottom:30px;
  right:40px;
}

/* ================= VISUALIZER ================= */
canvas#viz{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:160px;
  opacity:.35;
}
</style>
</head>

<body>

<canvas id="ripple"></canvas>

<!-- HOME -->
<div id="home">
  <div class="profile" onclick="openProfile('isaiah')">Isaiah</div>
  <div class="profile" onclick="openProfile('ryans_fam')">Ryanâ€™s Fam</div>
  <div class="profile" onclick="openProfile('wakena')">Wakena</div>
  <div class="profile" onclick="openProfile('elijah')">Elijah</div>
  <div class="profile" onclick="openProfile('pappa')">Pappa</div>
  <div class="profile" onclick="openProfile('guest')">Guest</div>
</div>

<!-- PLAYER -->
<div id="player" class="hidden">
  <h1 id="title"></h1>
  <div id="songs"></div>

  <div id="controls">
    <button onclick="logout()">Back</button>
  </div>
</div>

<canvas id="viz"></canvas>

<script>
/* ================= RIPPLE EFFECT ================= */
const rc=document.getElementById("ripple");
const rx=rc.getContext("2d");
let ripples=[];
function resize(){
  rc.width=innerWidth;
  rc.height=innerHeight;
}
resize(); onresize=resize;

addEventListener("pointerdown",e=>{
  ripples.push({x:e.clientX,y:e.clientY,r:0,o:.6});
});

(function drawRipples(){
  rx.clearRect(0,0,rc.width,rc.height);
  ripples.forEach(p=>{
    rx.beginPath();
    rx.arc(p.x,p.y,p.r,0,Math.PI*2);
    rx.strokeStyle=`rgba(0,255,200,${p.o})`;
    rx.lineWidth=2;
    rx.shadowBlur=20;
    rx.shadowColor="rgba(0,255,200,.8)";
    rx.stroke();
    p.r+=3;
    p.o-=.01;
  });
  ripples=ripples.filter(p=>p.o>0);
  requestAnimationFrame(drawRipples);
})();

/* ================= NAV ================= */
function openProfile(profile){
  fetch("http://localhost:3000/profile",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({profile})
  }).then(()=>{
    document.getElementById("home").classList.add("hidden");
    document.getElementById("player").classList.remove("hidden");
    document.getElementById("title").textContent=profile;
    loadSongs();
  });
}

function logout(){
  fetch("http://localhost:3000/logout",{method:"POST"});
  document.getElementById("player").classList.add("hidden");
  document.getElementById("home").classList.remove("hidden");
}

/* ================= LOAD SONGS FROM GITHUB ================= */
function loadSongs(){
  fetch("http://localhost:3000/songs")
    .then(r=>r.json())
    .then(list=>{
      const box=document.getElementById("songs");
      box.innerHTML="";
      list.forEach(s=>{
        const d=document.createElement("div");
        d.className="song";
        d.textContent=s.name.replace(".mp3","");
        d.onclick=()=>{
          fetch("http://localhost:3000/play",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({url:s.url})
          });
        };
        box.appendChild(d);
      });
    });
}

/* ================= VISUALIZER ================= */
const vc=document.getElementById("viz");
const vx=vc.getContext("2d");
function vs(){
  vc.width=innerWidth;
  vc.height=160;
}
vs();

(function drawViz(){
  vx.clearRect(0,0,vc.width,vc.height);
  for(let i=0;i<48;i++){
    const h=Math.sin(Date.now()/350+i)*35+70;
    vx.fillStyle="rgba(0,255,200,.7)";
    vx.fillRect(i*vc.width/48,vc.height-h,8,h);
  }
  requestAnimationFrame(drawViz);
})();
</script>

</body>
</html>
