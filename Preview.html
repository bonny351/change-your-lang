<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Spa Music Kiosk</title>

<style>
html,body{
  margin:0;width:100%;height:100%;
  font-family:Segoe UI,Arial,sans-serif;
  color:#eafff7;overflow:hidden;background:black;
}
body{
  background:url("background.jpg") center/cover no-repeat fixed;
}
#overlay{
  position:fixed;inset:0;
  background:radial-gradient(circle,rgba(0,0,0,.25),rgba(0,0,0,.7));
}
#waves{
  position:fixed;inset:0;pointer-events:none;
}
#home,#player{position:relative;z-index:2}

/* HOME */
#home{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:50px;
  padding:70px;
  margin:60px;
  background:rgba(0,0,0,.35);
  backdrop-filter:blur(10px);
  border-radius:30px;
}
#profileTitle{
  grid-column:1/-1;
  font-size:40px;
  text-align:center;
}
.profile{
  width:170px;height:170px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 0 40px currentColor;
  border:3px solid rgba(255,255,255,.15);
  color:#fff;
}
.profile-name{
  color:#ffffff;
  font-size:22px;
  font-weight:600;
  text-shadow:0 2px 8px rgba(0,0,0,.6);
}
.profile:active{transform:scale(.92)}
.isaiah{color:#4cffc3;background:radial-gradient(circle,#2bffc6,#0a4f3a)}
.ryans{color:#3ecbff;background:radial-gradient(circle,#38b6ff,#0a3650)}
.wakena{color:#00ffd0;background:radial-gradient(circle,#3dffe2,#0a4f46)}
.elijah{color:#ffd34c;background:radial-gradient(circle,#ffe48a,#5a4a12)}
.pappa{color:#ff8c4c;background:radial-gradient(circle,#ffb27a,#5a2a12)}
.guest{color:#b77cff;background:radial-gradient(circle,#b38cff,#3a1c6b)}

/* PLAYER */
#player{display:none;padding:40px 60px}
.songTitle{font-size:34px;margin-bottom:10px}
.controls{margin:20px 0;display:flex;gap:25px}
.ctrl{
  font-size:30px;padding:14px;border-radius:50%;
  background:rgba(0,255,200,.25);cursor:pointer;
}
.playlists{
  display:grid;grid-template-columns:1fr 1fr;gap:30px;
}
.panel{
  background:rgba(0,255,200,.1);
  border-radius:18px;padding:18px;
}
.list{max-height:220px;overflow-y:auto}
.track{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,.1);
  cursor:pointer;
}
.track:hover{color:#4cffc3}
input{
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}
.btn{
  padding:12px 26px;
  border-radius:14px;
  background:rgba(0,255,200,.25);
  cursor:pointer;
}
.footer{
  margin-top:20px;
  display:flex;
  justify-content:space-between;
}

/* FINDER */
#finder{
  position:fixed;
  inset:8%;
  background:rgba(0,0,0,.85);
  backdrop-filter:blur(18px);
  border-radius:30px;
  padding:30px;
  display:none;
  z-index:10;
}
.findResult{
  padding:14px;
  border-bottom:1px solid rgba(255,255,255,.1);
}
.findActions{
  display:flex;
  gap:12px;
  margin-top:6px;
}
</style>
</head>

<body>

<div id="overlay"></div>
<canvas id="waves"></canvas>

<div id="home">
  <div id="profileTitle">Who’s listening?</div>

  <div class="profile isaiah" onclick="openProfile('Isaiah')">
    <span class="profile-name">Isaiah</span>
  </div>
  <div class="profile ryans" onclick="openProfile('Ryan’s Fam')">
    <span class="profile-name">Ryan’s Fam</span>
  </div>
  <div class="profile wakena" onclick="openProfile('Wakena')">
    <span class="profile-name">Wakena</span>
  </div>
  <div class="profile elijah" onclick="openProfile('Elijah')">
    <span class="profile-name">Elijah</span>
  </div>
  <div class="profile pappa" onclick="openProfile('Pappa')">
    <span class="profile-name">Pappa</span>
  </div>
  <div class="profile guest" onclick="openProfile('Guest')">
    <span class="profile-name">Guest</span>
  </div>
</div>

<div id="player">
  <div class="songTitle" id="who"></div>

  <div class="controls">
    <div class="ctrl" onclick="prev()">⏮</div>
    <div class="ctrl" onclick="toggle()">⏯</div>
    <div class="ctrl" onclick="next()">⏭</div>
  </div>

  <div class="playlists">
    <div class="panel">
      <input id="search" placeholder="Search playlist…">
      <div class="list" id="songs"></div>
    </div>
    <div class="panel">
      <input type="file" accept=".mp3" multiple onchange="addFiles(this.files)">
      <div class="btn" onclick="openFinder()">Find Free Music</div>
    </div>
  </div>

  <div class="footer">
    <div class="btn" onclick="clearProfile()">Clear</div>
    <div class="btn" onclick="goHome()">Back</div>
  </div>
</div>

<div id="finder">
  <input id="finderSearch" placeholder="Search Internet Archive…">
  <div id="finderResults"></div>
  <div class="btn" onclick="closeFinder()">Close</div>
</div>

<audio id="audio" crossorigin="anonymous"></audio>

<script>
/* ===== STATE ===== */
let tracks=[],current=0;

/* ===== AUDIO CORE ===== */
const audio=document.getElementById("audio");
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
const analyser=audioCtx.createAnalyser();
analyser.fftSize=256;
let source=audioCtx.createMediaElementSource(audio);
source.connect(analyser);
analyser.connect(audioCtx.destination);
const dataArray=new Uint8Array(analyser.frequencyBinCount);

function loadAndPlay(src){
  audio.pause();
  audio.src=src;
  audioCtx.resume();

  try{source.disconnect();}catch(e){}
  source=audioCtx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(audioCtx.destination);

  audio.play();
}

/* ===== PROFILE ===== */
function openProfile(n){
  who.textContent="Now Playing for "+n;
  home.style.display="none";
  player.style.display="block";
}
function goHome(){
  audio.pause();
  player.style.display="none";
  home.style.display="grid";
}

/* ===== PLAYBACK ===== */
function play(i){
  current=i;
  const t=tracks[i];
  loadAndPlay(t.src||URL.createObjectURL(t.file));
}
function toggle(){audio.paused?audio.play():audio.pause()}
function next(){tracks.length&&play((current+1)%tracks.length)}
function prev(){tracks.length&&play((current-1+tracks.length)%tracks.length)}

/* ===== FILES ===== */
function addFiles(files){
  for(const f of files) tracks.push({name:f.name,file:f});
  render();
}
function clearProfile(){tracks=[];render()}

/* ===== RENDER ===== */
function render(){
  songs.innerHTML="";
  tracks.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className="track";
    d.textContent=t.name.replace(".mp3","");
    d.onclick=()=>play(i);
    songs.appendChild(d);
  });
}

/* ===== SEARCH FILTER ===== */
search.oninput=e=>{
  const q=e.target.value.toLowerCase();
  [...songs.children].forEach(d=>{
    d.style.display=d.textContent.toLowerCase().includes(q)?"":"none";
  });
};

/* ===== FINDER ===== */
function openFinder(){finder.style.display="block"}
function closeFinder(){finder.style.display="none"}

finderSearch.onkeydown=e=>{
  if(e.key==="Enter")searchArchive(e.target.value);
};

async function searchArchive(q){
  finderResults.innerHTML="Searching…";
  const r=await fetch(
    `https://archive.org/advancedsearch.php?q=${encodeURIComponent(q)} AND mediatype:audio&rows=12&output=json`
  );
  const data=await r.json();
  finderResults.innerHTML="";

  for(const d of data.response.docs){
    const title=d.identifier;
    const div=document.createElement("div");
    div.className="findResult";
    div.innerHTML=`
      <div>${title}</div>
      <div class="findActions">
        <div class="btn" onclick="previewArchive('${d.identifier}')">▶ Preview</div>
        <div class="btn" onclick="downloadArchive('${d.identifier}','${title}')">⬇ Download</div>
      </div>`;
    finderResults.appendChild(div);
  }
}

async function getArchiveMP3(id){
  const r=await fetch(`https://archive.org/metadata/${id}`);
  const data=await r.json();
  return data.files.find(f=>f.name&&f.name.endsWith(".mp3"));
}

async function previewArchive(id){
  const mp3=await getArchiveMP3(id);
  if(!mp3)return alert("No MP3 found");
  loadAndPlay(`https://archive.org/download/${id}/${mp3.name}`);
}

async function downloadArchive(id,title){
  const mp3=await getArchiveMP3(id);
  if(!mp3)return alert("No MP3 found");

  const remote=`https://archive.org/download/${id}/${mp3.name}`;
  const blob=await (await fetch(remote)).blob();
  const local=URL.createObjectURL(blob);

  const safeName=title.replace(/[^a-z0-9 _-]/gi,"").trim()||"Track";

  tracks.push({name:safeName+".mp3",src:local});
  render();
}

/* ===== WAVES ===== */
const waveCanvas=document.getElementById("waves");
const wctx=waveCanvas.getContext("2d");
function resize(){waveCanvas.width=innerWidth;waveCanvas.height=innerHeight}
resize();addEventListener("resize",resize);

let t=0;
function drawWaves(){
  wctx.clearRect(0,0,waveCanvas.width,waveCanvas.height);
  analyser.getByteFrequencyData(dataArray);
  let bass=dataArray.slice(0,10).reduce((a,b)=>a+b,0)/2550;
  for(let i=0;i<3;i++){
    wctx.beginPath();
    const amp=20+bass*60+i*8;
    const y=waveCanvas.height*0.6+i*30;
    for(let x=0;x<=waveCanvas.width;x+=8){
      wctx.lineTo(x,y+Math.sin(x/180+t*0.02+i)*amp);
    }
    wctx.strokeStyle=`rgba(0,255,200,${0.12-i*0.03})`;
    wctx.lineWidth=2;
    wctx.stroke();
  }
  t++;requestAnimationFrame(drawWaves);
}
drawWaves();

document.addEventListener("pointerdown",()=>audioCtx.resume(),{once:true});
</script>

</body>
</html>
