<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Now Playing</title>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#040f14;
  font-family:"Segoe UI",system-ui,sans-serif;
  color:white;
  overflow:hidden;
}

/* ===== BACKGROUND ===== */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at top, rgba(0,255,200,.25), transparent 55%),
    radial-gradient(circle at bottom, rgba(0,140,255,.35), transparent 60%),
    linear-gradient(#020b14,#061b25);
}

/* ===== WAVES ===== */
#waves{
  position:fixed;
  inset:0;
  pointer-events:none;
}

/* ===== LAYOUT ===== */
#app{
  position:relative;
  z-index:2;
  height:100%;
  padding:40px 60px;
  display:flex;
  flex-direction:column;
}

/* HEADER */
#header{
  display:flex;
  align-items:center;
  gap:25px;
}
#avatar{
  width:90px;height:90px;border-radius:50%;
  background:radial-gradient(circle,#3cffb4,#0a4f3a);
  box-shadow:0 0 35px #3cffb4;
}
#profileName{font-size:36px}

/* PLAYER */
#nowPlaying{display:flex;gap:35px;margin-top:25px}
#cover{
  width:160px;height:160px;border-radius:12px;
  background:linear-gradient(135deg,#ffaa55,#553300);
  box-shadow:0 0 30px rgba(255,170,85,.5);
}
#songTitle{font-size:32px;margin:0}

/* CONTROLS */
#controls{display:flex;gap:25px;margin-top:15px}
.ctrl{
  width:70px;height:70px;border-radius:50%;
  background:radial-gradient(circle,#3cffb4,#0a4f3a);
  box-shadow:0 0 35px #3cffb4;
  display:flex;align-items:center;justify-content:center;
  font-size:30px;cursor:pointer;
}

/* PROGRESS */
#progress{width:420px;margin-top:15px}

/* PLAYLIST */
#lists{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-top:35px}
.panel{
  background:rgba(0,0,0,.35);
  border-radius:16px;padding:20px;
}
.song{padding:10px;border-bottom:1px solid rgba(255,255,255,.1);cursor:pointer}
.song:hover{background:rgba(255,255,255,.08)}

#footer{margin-top:auto;display:flex;justify-content:space-between}
.footerBtn{
  padding:14px 30px;border-radius:20px;
  background:rgba(0,255,200,.18);
  box-shadow:0 0 25px rgba(0,255,200,.4);
  cursor:pointer;
}
</style>
</head>

<body>

<canvas id="waves"></canvas>

<div id="app">

  <div id="header">
    <div id="avatar"></div>
    <div id="profileName"></div>
  </div>

  <div id="nowPlaying">
    <div id="cover"></div>
    <div>
      <h2 id="songTitle">Select a song</h2>
      <input id="progress" type="range" min="0" max="100" value="0">
      <div id="controls">
        <div class="ctrl">⏮</div>
        <div class="ctrl">▶</div>
        <div class="ctrl">⏭</div>
      </div>
    </div>
  </div>

  <div id="lists">
    <div class="panel" id="playlist"></div>
    <div class="panel">
      <p style="opacity:.7">
        • Add songs from USB or storage<br>
        • Long-press a song to remove<br>
        • Guest resets after 7 hours
      </p>
    </div>
  </div>

  <div id="footer">
    <div class="footerBtn" onclick="location.href='index.html'">
      Back to Profiles
    </div>
  </div>

</div>

<input id="filePick" type="file" accept=".mp3" multiple hidden>

<script>
/* PROFILE */
const params = new URLSearchParams(location.search);
const profile = params.get("profile") || "Guest";
profileName.textContent = "Now Playing for " + profile;

/* GUEST TIMER */
const GUEST_TIMEOUT = 7 * 60 * 60 * 1000;
const now = Date.now();
const KEY = "playlist_" + profile;

if(profile === "Guest"){
  const last = localStorage.getItem("guest_last");
  if(!last || now - last > GUEST_TIMEOUT){
    localStorage.removeItem(KEY);
  }
  localStorage.setItem("guest_last", now);
}

/* AUDIO */
const audio = new Audio();
let current = 0;
let playlist = JSON.parse(localStorage.getItem(KEY)) || [];

/* SAVE */
function save(){
  localStorage.setItem(KEY, JSON.stringify(playlist));
  if(profile === "Guest") localStorage.setItem("guest_last", Date.now());
}

/* RENDER */
function render(){
  playlistDiv.innerHTML = `<h3>${profile}’s Playlist</h3>`;
  playlist.forEach((s,i)=>{
    const d=document.createElement("div");
    d.className="song";
    d.textContent=s.name;
    d.onclick=()=>play(i);
    d.oncontextmenu=e=>{
      e.preventDefault();
      if(confirm("Remove song?")){
        playlist.splice(i,1);
        save();render();
      }
    };
    playlistDiv.appendChild(d);
  });
  const add=document.createElement("div");
  add.className="song";
  add.textContent="➕ Add from USB / Storage";
  add.onclick=()=>filePick.click();
  playlistDiv.appendChild(add);
}
const playlistDiv=document.getElementById("playlist");

/* ADD FILES */
filePick.onchange=()=>{
  [...filePick.files].forEach(f=>{
    playlist.push({ name:f.name.replace(".mp3",""), src:URL.createObjectURL(f) });
  });
  save();render();
};

/* PLAYBACK */
function play(i){
  current=i;
  audio.src=playlist[i].src;
  audio.play();
  songTitle.textContent=playlist[i].name;
}
document.querySelectorAll(".ctrl")[0].onclick=()=>play((current-1+playlist.length)%playlist.length);
document.querySelectorAll(".ctrl")[1].onclick=()=>audio.paused?audio.play():audio.pause();
document.querySelectorAll(".ctrl")[2].onclick=()=>play((current+1)%playlist.length);

audio.ontimeupdate=()=>{
  if(audio.duration) progress.value=(audio.currentTime/audio.duration)*100;
};
progress.oninput=()=>{
  if(audio.duration) audio.currentTime=(progress.value/100)*audio.duration;
};

/* INIT */
render();

/* WAVES */
const c=waves,ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();addEventListener("resize",resize);
let t=0;
(function draw(){
  ctx.clearRect(0,0,c.width,c.height);
  for(let i=0;i<3;i++){
    ctx.beginPath();
    for(let x=0;x<=c.width;x+=6){
      ctx.lineTo(x,c.height*.82+Math.sin(x/160+t+i)*25);
    }
    ctx.strokeStyle=`rgba(0,255,200,${0.25-i*.06})`;
    ctx.lineWidth=3;
    ctx.shadowBlur=20;
    ctx.shadowColor="#3cffb4";
    ctx.stroke();
  }
  t+=.02;
  requestAnimationFrame(draw);
})();
</script>

</body>
</html>
